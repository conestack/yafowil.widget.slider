!function(s,e){"use strict";class t{constructor(s,t,i){this.slider=s,this.elem=e("<div />").addClass("slider-handle").width(this.slider.options.handle_diameter).height(this.slider.options.handle_diameter),this.slider.slider_elem.append(this.elem),this.input_elem=t,this.span_elem=i,this.value=this.input_elem.val(),this.pos=this.transform(this.value,"screen"),this.vertical=this.slider.vertical,this.step=this.slider.step,this.elem.css(`${this.slider.dir_attr}`,this.pos),this.slide_start=this.slide_start.bind(this),this.handle_drag=this.handle_drag.bind(this),this.elem.on("mousedown touchstart",this.slide_start),this.resize_handle=this.resize_handle.bind(this),e(window).on("resize",this.resize_handle)}get offset(){return this.slider.offset}get value(){return this._value}set value(s){this.input_elem.attr("value",s),this.span_elem.text(s),this._value=s}get pos(){return this._pos}set pos(s){let e=this.slider.handles.indexOf(this);if(this.slider.range_true&&e>=0)for(let t in this.slider.handles){let i=this.slider.handles[t];t!==e&&(s>=i.pos&&t>e||s<=i.pos&&t<e)&&(s=i.pos+1,this.value=i.value)}s>=this.slider.slider_dim?s=this.slider.slider_dim:s<=0&&(s=0),this.elem.css(`${this.slider.dir_attr}`,`${s}px`),this._pos=s}unload(){e(window).off("resize",this.resize_handle)}resize_handle(){this.pos=this.transform(this.value,"screen")}slide_start(s){s.preventDefault(),s.stopPropagation(),e(".slider-handle").css("z-index",1),this.elem.css("z-index",10),["mousemove","touchmove"].forEach((s=>document.addEventListener(s,this.handle_drag,{passive:!1}))),["mouseup","touchend"].forEach((s=>document.addEventListener(s,(()=>{document.removeEventListener("touchmove",this.handle_drag),document.removeEventListener("mousemove",this.handle_drag)}),!1)))}handle_drag(s){s.preventDefault(),s.stopPropagation(),"mousemove"===s.type?this.pos=(this.vertical?s.pageY:s.pageX)-this.offset:this.pos=(this.vertical?s.touches[0].pageY:s.touches[0].pageX)-this.offset,this.value=this.transform(this.pos,"range"),this.slider.step&&(this.value=this.transform(this.value,"step"),this.pos=this.transform(this.value,"screen"));const t=new e.Event("drag");this.slider.slider_elem.trigger(t)}transform(s,e){let t=this.slider.min,i=this.slider.max,h=this.slider.step;if("step"===e){s=(s=s>(0===t?i-h/2:i-t/2)?i:h*parseInt(s/h))<=t?t:s}else"screen"===e?s=parseInt(this.slider.slider_dim*((s-t)/(i-t))):"range"===e&&(s=parseInt((i-t)*(s/this.slider.slider_dim)+t));return s}}class i{constructor(s){this.slider=s,this.track=e("<div />").addClass("slider-value-track"),this.bg=e("<div />").addClass("slider-bg"),this.slider.slider_elem.append(this.bg).append(this.track),this.slider.vertical?(this.track.css("width",this.slider.options.thickness),this.bg.css("width",this.slider.options.thickness)):(this.track.css("height",this.slider.options.thickness),this.bg.css("height",this.slider.options.thickness)),this.slider.range_max&&(this.slider.vertical?this.track.css("bottom",0).css("top","unset"):this.track.css("right",0)),this.set_value(),this.set_value=this.set_value.bind(this),this.slider.slider_elem.on("drag",this.set_value),e(window).on("resize",this.set_value)}unload(){e(window).off("resize",this.set_value)}set_value(s){let e=this.slider.handles[0].pos;if(this.slider.range_true){let s=this.slider.handles[1].pos-this.slider.handles[0].pos;this.track.css(`${this.slider.dim_attr}`,s).css(`${this.slider.dir_attr}`,`${e}px`)}else this.slider.range_max?this.track.css(`${this.slider.dim_attr}`,this.slider.slider_dim-e):this.track.css(`${this.slider.dim_attr}`,e)}}class h{static initialize(s){e(".yafowil_slider",s).each((function(){let s=e(this),t=s.data();new h(s,t)}))}constructor(s,h){this.elem=s,this.options=h,this.options.handle_diameter=this.options.handle_diameter??20,this.options.thickness=this.options.thickness??15,this.min=this.options.min??0,this.max=this.options.max??100,this.step=this.options.step??1,this.slider_elem=e("div.slider",this.elem),this.vertical="vertical"===this.options.orientation,this.dim_attr=this.vertical?"height":"width",this.dir_attr=this.vertical?"top":"left",this.vertical?(this.slider_elem.addClass("slider-vertical"),this.slider_elem.css("width",this.options.handle_diameter)):this.slider_elem.css("height",this.options.handle_diameter),this.handles=[],this.range_true?(this.handles.push(new t(this,e("input.lower_value",this.elem),e("span.lower_value",this.elem))),this.handles.push(new t(this,e("input.upper_value",this.elem),e("span.upper_value",this.elem)))):this.handles.push(new t(this,e("input.slider_value",this.elem),e("span.slider_value",this.elem))),this.slider_track=new i(this),this.handle_singletouch=this.handle_singletouch.bind(this),this.slider_elem.on("mousedown touchstart",this.handle_singletouch)}get range_max(){return"max"===this.options.range}get range_true(){return!0===this.options.range}get offset(){return this.vertical?this.slider_elem.offset().top:this.elem.offset().left}get slider_dim(){return this.vertical?this.slider_elem.height():this.elem.width()}handle_singletouch(s){let e,t;if(e="mousedown"===s.type?(this.vertical?s.pageY:s.pageX)-this.offset:(this.vertical?s.touches[0].pageY:s.touches[0].pageX)-this.offset,this.range_true){let e=[];for(let t of this.handles){let i=Math.hypot(t.elem.offset().left-parseInt(s.clientX),t.elem.offset().top-parseInt(s.clientY));e.push(parseInt(i))}let i=e.indexOf(Math.min(...e));t=this.handles[i]}else t=this.handles[0];this.step?(e=t.transform(e,"range"),t.value=t.transform(e,"step"),t.pos=t.transform(t.value,"screen")):(t.pos=e,t.value=t.transform(e,"range")),this.slider_track.set_value(s)}}e((function(){void 0!==window.ts?ts.ajax.register(h.initialize,!0):h.initialize()})),s.SliderWidget=h,Object.defineProperty(s,"__esModule",{value:!0}),void 0===window.yafowil&&(window.yafowil={}),window.yafowil.slider=s}({},jQuery);
