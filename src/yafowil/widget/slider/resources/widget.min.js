var yafowil_slider=function(e,t){"use strict";function s(e){if(!e)return null;source=e.split(".");let t,s=window;for(let e in source){if(t=source[e],void 0===s[t])throw"'"+t+"' not found.";s=s[t]}return s}function i(e,t,s,i,a,l){if("step"===t){e=(e=e>(0===i?a-l/2:a-i/2)?a:l*parseInt(e/l))<=i?i:e}else"screen"===t?e=parseInt(s*((e-i)/(a-i))):"range"===t&&(e=Math.ceil(e/s*(a-i)+i));return e}class a{constructor(e,s,i){this.slider=e;let a=e.handle_diameter;this.elem=t("<div />").addClass("slider-handle").width(a).height(a).appendTo(e.elem),this.elem.data("slider-handle",this),this.index=s,this._value=i,this.pos=this.transform(this.value,"screen"),this.selected=!1,this.elem.css(`${e.dir_attr}`,this.pos),this._on_start=this._on_start.bind(this),this._on_move=this._on_move.bind(this),this._on_end=this._on_end.bind(this),this._on_scroll=this._on_scroll.bind(this),this._on_key=this._on_key.bind(this),this._on_resize=this._on_resize.bind(this),this.elem.on("mousedown touchstart",this._on_start),t(window).on("resize",this._on_resize)}get value(){return this._value}set value(e){let t=this.slider;if(e<t.min?e=t.min:e>t.max&&(e=t.max),t.range_true){let s=t.handles,i=this.index;for(let t in s){let a=s[t];(e>=a.value&&t>i||e<=a.value&&t<i)&&(e=a.value)}}this._value=e}get selected(){return this._selected}set selected(e){let s=this.elem,i=this.slider;e?(t("div.slider-handle").each((function(){t(this).data("slider-handle").selected=!1})),s.addClass("active").css("z-index",10),i.elem.on("mousewheel wheel",this._on_scroll),t(document).off("keydown",this._on_key).on("keydown",this._on_key)):(s.removeClass("active").css("z-index",1),i.elem.off("mousewheel wheel",this._on_scroll),t(document).off("keydown",this._on_key)),this._selected=e}get pos(){return this._pos}set pos(e){let t=this.slider;if(t.range_true){let s=t.handles,i=this.index;for(let t in s){let a=s[t];(e>=a.pos&&t>i||e<=a.pos&&t<i)&&(e=a.pos)}}e>=t.slider_dim?e=t.slider_dim:e<=0&&(e=0),this.elem.css(`${t.dir_attr}`,`${e}px`),this._pos=e}unload(){t(window).off("resize",this._on_resize),this.selected=!1}_on_resize(){this.pos=this.transform(this.value,"screen")}_on_start(e){e.preventDefault(),e.stopPropagation(),this.selected=!0,this.slider.trigger("start",this),t(document).on("mousemove touchmove",this._on_move),t(document).one("mouseup touchend",this._on_end)}_on_move(e){e.preventDefault(),e.stopPropagation();let t=this.slider,s=t.vertical,i=t.offset;if("mousemove"===e.type?this.pos=(s?e.pageY:e.pageX)-i:this.pos=(s?e.touches[0].pageY:e.touches[0].pageX)-i,t.step){let e=this.transform(this.pos,"range");this.value=this.transform(e,"step"),this.pos=this.transform(this.value,"screen")}else this.value=this.transform(this.pos,"range");t.trigger("slide",this)}_on_end(e){e.preventDefault(),t(document).off("mousemove touchmove",this._on_move),this.slider.trigger("stop",this)}_on_scroll(e){e.preventDefault();let t=e.originalEvent,s=this.slider,i=s.scroll_step,a=this.value;t.deltaY>0?a=parseInt(this.value)+i:t.deltaY<0&&(a=parseInt(this.value)-i),this.pos=this.transform(a,"screen"),this.value=a,s.track.update(),s.trigger("change",this)}_on_key(e){let t=this.value,s=this.slider,i=s.scroll_step,a=s.vertical,l=a?"ArrowDown"===e.key:"ArrowRight"===e.key,r=a?"ArrowUp"===e.key:"ArrowLeft"===e.key;if(l)e.preventDefault(),t=parseInt(this.value)+i;else{if(!r)return;e.preventDefault(),t=parseInt(this.value)-i}this.pos=this.transform(t,"screen"),this.value=t,s.track.update(),s.trigger("change",this)}transform(e,t){let s=this.slider,a=s.min,l=s.max,r=s.step;return i(e,t,s.slider_dim,a,l,r)}}class l{constructor(e){this.slider=e,this.dim_attr=e.vertical?"height":"width";let s=e.vertical?"width":"height";this.bg_elem=t("<div />").addClass("slider-bg").css(s,e.thickness).appendTo(e.elem),this.track_elem=t("<div />").addClass("slider-value-track").css(s,e.thickness).appendTo(e.elem),e.range_max&&(e.vertical?this.track_elem.css("bottom",0).css("top","unset"):this.track_elem.css("right",0)),this.update=this.update.bind(this),e.elem.on("slide",this.update),t(window).on("resize",this.update),this.update()}unload(){t(window).off("resize",this.update)}update(){let e=this.slider,t=e.handles,s=t[0].pos;if(e.range_true){let i=t[1].pos-t[0].pos;this.track_elem.css(`${this.dim_attr}`,i).css(`${e.dir_attr}`,`${s}px`)}else e.range_max?this.track_elem.css(`${this.dim_attr}`,e.slider_dim-s):this.track_elem.css(`${this.dim_attr}`,s)}}class r{constructor(e,t){this.elem=e,this.range=t.range||!1,this.handle_diameter=t.handle_diameter||20,this.thickness=t.thickness||8,this.min=t.min||0,this.max=t.max||100,this.step=t.step||!1;let s=t.scroll_step||1;this.scroll_step=t.step||s,this.vertical="vertical"===t.orientation,this.dir_attr=this.vertical?"top":"left",this.vertical?e.addClass("slider-vertical").css("width",this.handle_diameter).css("height",t.height):e.css("height",this.handle_diameter),this.range_true?(this.value=t.value||[0,0],this.handles=[new a(this,0,this.value[0]),new a(this,1,this.value[1])]):(this.value=t.value||0,this.handles=[new a(this,0,this.value)]),this.track=new l(this),this._on_down=this._on_down.bind(this),this.elem.on("mousedown touchstart",this._on_down);for(let e of["change","create","slide","start","stop"])t[e]&&this.elem.on(e,t[e]);this.trigger("create",this)}get range_max(){return"max"===this.range}get range_true(){return!0===this.range}get offset(){let e=this.elem.offset();return this.vertical?e.top:e.left}get slider_dim(){let e=this.elem;return this.vertical?e.height():e.width()}on(e,t){this.elem.on(e,t)}off(e,t){this.elem.off(e,t)}trigger(e,s){this.elem.trigger(new t.Event(e,{widget:s}))}unload(){this.track.unload();for(let e of this.handles)e.unload()}_on_down(e){let t,s;if(this.range_true){let t=[];for(let s of this.handles){let i="mousedown"===e.type?e.pageX:e.touches[0].pageX,a="mousedown"===e.type?e.pageY:e.touches[0].pageY,l=s.elem.offset(),r=Math.hypot(l.left-parseInt(i),l.top-parseInt(a));t.push(parseInt(r))}let i=t.indexOf(Math.min(...t));s=this.handles[i]}else s=this.handles[0];s.selected=!0;let i=this.offset,a=this.vertical;t="mousedown"===e.type?(a?e.pageY:e.pageX)-i:(a?e.touches[0].pageY:e.touches[0].pageX)-i,this.step?(t=s.transform(t,"range"),s.value=s.transform(t,"step"),s.pos=s.transform(s.value,"screen")):(s.pos=t,s.value=s.transform(t,"range")),this.track.update(),this.trigger("change",s)}}class n{static initialize(e){t(".yafowil_slider",e).each((function(){let e=t(this);new n(e,{min:e.data("min"),max:e.data("max"),step:e.data("step"),scroll_step:e.data("scroll_step"),range:e.data("range"),handle_diameter:e.data("handle_diameter"),thickness:e.data("thickness"),orientation:e.data("orientation"),height:e.data("height"),change:s(e.data("change")),create:s(e.data("create")),slide:s(e.data("slide")),start:s(e.data("start")),stop:s(e.data("stop"))})}))}constructor(e,s){e.data("yafowil-slider",this),this.elem=e,this.range=s.range,!0===this.range?(this.elements=[{input:t("input.lower_value",e),label:t("span.lower_value",e)},{input:t("input.upper_value",e),label:t("span.upper_value",e)}],s.value=[parseInt(this.elements[0].input.val()),parseInt(this.elements[1].input.val())]):(this.elements=[{input:t("input.slider_value",e),label:t("span.slider_value",e)}],s.value=parseInt(this.elements[0].input.val())),this.update_value=this.update_value.bind(this),this.slider=new r(t("div.slider",e),s),this.slider.on("change slide stop",this.update_value)}update_value(e){let t=e.widget,s=t.index,i=this.elements[s];i.input.val(t.value),i.label.html(t.value)}}return t((function(){void 0!==window.ts?ts.ajax.register(n.initialize,!0):void 0!==window.bdajax?bdajax.register(n.initialize,!0):n.initialize()})),e.Slider=r,e.SliderWidget=n,e.lookup_callback=s,e.transform=i,Object.defineProperty(e,"__esModule",{value:!0}),window.yafowil=window.yafowil||{},window.yafowil.slider=e,e}({},jQuery);
