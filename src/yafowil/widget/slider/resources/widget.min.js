var yafowil_slider=function(e,t){"use strict";function s(e){if(!e)return null;let t,s=e.split("."),i=window;for(const e in s){if(t=s[e],void 0===i[t])throw"'"+t+"' not found.";i=i[t]}return i}class i{constructor(e,s,i){this.slider=e;let a=e.handle_diameter;this.elem=t("<div />").addClass("slider-handle").width(a).height(a).appendTo(e.elem),this.elem.data("slider-handle",this),this.index=s,this.value=i,this.selected=!1,this._on_start=this._on_start.bind(this),this._on_move=this._on_move.bind(this),this._on_end=this._on_end.bind(this),this._on_scroll=this._on_scroll.bind(this),this._on_key=this._on_key.bind(this),this._on_resize=this._on_resize.bind(this),this.elem.on("mousedown touchstart",this._on_start),t(window).on("resize",this._on_resize)}get value(){return this._value}set value(e){let t=this.slider,s=t.min,i=t.max;e=this._align_value(e,s,t.step),(e=this._prevent_overlap(e))<s?e=s:e>i&&(e=i);let a=t.slider_len*((e-s)/(i-s));a=t.vertical?t.elem.height()-a:a,this.elem.css(`${t.dir_attr}`,`${a}px`),this._pos=a,this._value=e}get pos(){return this._pos}set pos(e){let t=this.slider,s=t.min,i=t.max,a=t.slider_len;e=t.vertical?t.elem.height()-e:e,this.value=Math.round(e/a*(i-s)+s)}get selected(){return this._selected}set selected(e){let s=this.elem,i=this.slider;e?(i.unselect_handles(),s.addClass("active").css("z-index",10),i.elem.on("mousewheel wheel",this._on_scroll),t(document).off("keydown",this._on_key).on("keydown",this._on_key)):(s.removeClass("active").css("z-index",1),i.elem.off("mousewheel wheel",this._on_scroll),t(document).off("keydown",this._on_key)),this._selected=e}unload(){t(window).off("resize",this._on_resize),this.selected=!1}destroy(){this.unload(),this.elem.remove()}_on_resize(){this.value=this.value}_on_start(e){e.preventDefault(),e.stopPropagation(),this.selected=!0,this.slider.trigger("start",this),t(document).on("mousemove touchmove",this._on_move),t(document).one("mouseup touchend",this._on_end)}_on_move(e){e.preventDefault(),e.stopPropagation();let t=this.slider;this.pos=t.pos_from_evt(e),t.trigger("slide",this)}_on_end(e){e.preventDefault(),t(document).off("mousemove touchmove",this._on_move),this.slider.trigger("stop",this)}_on_scroll(e){e.preventDefault();let t=e.originalEvent,s=this.slider,i=s.scroll_step,a=this.value;t.deltaY>0?a=this.value+i:t.deltaY<0&&(a=this.value-i),this.value=a,s.track.update(),s.trigger("change",this)}_on_key(e){let t=this.value,s=this.slider,i=s.scroll_step,a=s.vertical,l=a?"ArrowUp"===e.key:"ArrowRight"===e.key,n=a?"ArrowDown"===e.key:"ArrowLeft"===e.key;if(l)e.preventDefault(),t=this.value+i;else{if(!n)return;e.preventDefault(),t=this.value-i}this.value=t,s.track.update(),s.trigger("change",this)}_align_value(e,t,s){if(!s)return e;let i=(e-=t)%s;return e=Math.floor(e/s)*s,i>=s/2&&(e+=s),e+t}_prevent_overlap(e){let t=this.slider.handles,s=this.index;if(void 0===t)return e;if(s>0){let i=t[s-1];e<i.value&&(e=i.value)}if(s<t.length-1){let i=t[s+1];e>i.value&&(e=i.value)}return e}}class a{constructor(e){this.slider=e,this.len_attr=e.vertical?"height":"width";let s=e.vertical?"width":"height";this.elem=t("<div />").addClass("slider-bg").css(s,e.thickness).appendTo(e.elem),this.range_elem=null;let i=e.range;i&&(this.range_elem=t("<div />").addClass("slider-value-track").css(s,e.thickness).appendTo(e.elem),"max"===i&&(e.vertical?this.range_elem.css("bottom",0).css("top","unset"):this.range_elem.css("right",0))),this.update=this.update.bind(this),e.elem.on("slide",this.update),t(window).on("resize",this.update),this.update()}unload(){t(window).off("resize",this.update)}destroy(){this.unload(),this.elem.remove()}update(){let e=this.slider,t=e.range;if(!t)return;let s=e.handles,i=s[0].pos,a=this.range_elem,l=this.len_attr;!0===t?a.css(`${l}`,s[1].pos-s[0].pos).css(`${e.dir_attr}`,`${i}px`):"min"===t?a.css(`${l}`,i):"max"===t&&a.css(`${l}`,e.slider_len-i)}}class l{constructor(e,t){this.elem=e,this.range=t.range||!1,this.handle_diameter=t.handle_diameter||20,this.thickness=t.thickness||8,this.min=t.min||0,this.max=t.max||100,this.step=t.step||!1;let s,l=t.scroll_step||1;this.scroll_step=t.step||l,this.vertical="vertical"===t.orientation,this.dir_attr=this.vertical?"top":"left",this.vertical?e.addClass("slider-vertical").css("width",this.handle_diameter).css("height",t.height):e.css("height",this.handle_diameter),!0===this.range?(s=this._value=t.value||[0,0],this.handles=[new i(this,0,s[0]),new i(this,1,s[1])]):(s=this._value=t.value||0,this.handles=[new i(this,0,s)]),this.track=new a(this),this._on_down=this._on_down.bind(this),this.elem.on("mousedown touchstart",this._on_down);for(let e of["change","create","slide","start","stop"])t[e]&&this.elem.on(e,t[e]);this.trigger("create",this)}get value(){return this._value}set value(e){!e instanceof Array&&(e=[e]);for(let t in this.handles)this.handles[t]=e[t];this._value=e}get offset(){let e=this.elem.offset();return this.vertical?e.top:e.left}get slider_len(){let e=this.elem;return this.vertical?e.height():e.width()}on(e,t){this.elem.on(e,t)}off(e,t){this.elem.off(e,t)}trigger(e,s){this.elem.trigger(new t.Event(e,{widget:s}))}unload(){this.track.unload();for(let e of this.handles)e.unload()}destroy(){for(let e of this.handles)e.destroy();this.track.destroy()}unselect_handles(){t("div.slider-handle").each((function(){t(this).data("slider-handle").selected=!1}))}pos_from_evt(e){let t=this.offset,s=this.vertical;return"mousedown"===e.type||"mousemove"===e.type?(s?e.pageY:e.pageX)-t:(s?e.touches[0].pageY:e.touches[0].pageX)-t}_on_down(e){let t,s=0;if(!0===this.range){let t=[];for(let s of this.handles){let i="mousedown"===e.type?e.pageX:e.touches[0].pageX,a="mousedown"===e.type?e.pageY:e.touches[0].pageY,l=s.elem.offset(),n=Math.hypot(l.left-parseInt(i),l.top-parseInt(a));t.push(parseInt(n))}s=t.indexOf(Math.min(...t))}t=this.handles[s],t.selected=!0,t.pos=this.pos_from_evt(e),this.track.update(),this.trigger("change",t)}}class n{static initialize(e){t(".yafowil_slider",e).each((function(){let e=t(this);if(e.parents(".arraytemplate").length)return;let i=e.data("yafowil-slider");i&&i.slider.destroy(),new n(e,{min:e.data("min"),max:e.data("max"),step:e.data("step"),scroll_step:e.data("scroll_step"),range:e.data("range"),handle_diameter:e.data("handle_diameter"),thickness:e.data("thickness"),orientation:e.data("orientation"),height:e.data("height"),change:s(e.data("change")),create:s(e.data("create")),slide:s(e.data("slide")),start:s(e.data("start")),stop:s(e.data("stop"))})}))}constructor(e,s){e.data("yafowil-slider",this),this.elem=e,this.range=s.range,!0===this.range?(this.elements=[{input:t("input.lower_value",e),label:t("span.lower_value",e)},{input:t("input.upper_value",e),label:t("span.upper_value",e)}],s.value=[parseInt(this.elements[0].input.val()),parseInt(this.elements[1].input.val())]):(this.elements=[{input:t("input.slider_value",e),label:t("span.slider_value",e)}],s.value=parseInt(this.elements[0].input.val())),this.update_value=this.update_value.bind(this),this.slider=new l(t("div.slider",e),s),this.slider.on("change slide stop",this.update_value)}destroy(){this.slider.destroy()}update_value(e){let t=e.widget,s=t.index,i=this.elements[s];i.input.attr("value",t.value),i.label.html(t.value)}}function r(e,t){n.initialize(t,!0)}function h(){void 0!==window.yafowil_array&&window.yafowil_array.on_array_event("on_add",r)}return t((function(){void 0!==window.ts?ts.ajax.register(n.initialize,!0):void 0!==window.bdajax?bdajax.register(n.initialize,!0):n.initialize(),h()})),e.Slider=l,e.SliderHandle=i,e.SliderWidget=n,e.lookup_callback=s,e.register_array_subscribers=h,Object.defineProperty(e,"__esModule",{value:!0}),window.yafowil=window.yafowil||{},window.yafowil.slider=e,e}({},jQuery);
