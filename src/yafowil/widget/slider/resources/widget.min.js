!function(e,s){"use strict";function t(e,s,t,i,l,h){if("step"===s){e=(e=e>(0===i?l-h/2:l-i/2)?l:h*parseInt(e/h))<=i?i:e}else if("screen"===s)e=parseInt(t*((e-i)/(l-i)));else if("range"===s){let s=Math.ceil(e/t*(l-i)+i);e=parseInt(s)}return e}class i{constructor(e,t,i){this.slider=e,this.elem=s("<div />").addClass("slider-handle").width(this.slider.handle_diameter).height(this.slider.handle_diameter),this.slider.slider_elem.append(this.elem),this.input_elem=t,this.span_elem=i,this.value=void 0!==this.input_elem.val()?parseInt(this.input_elem.val()):0,this.pos=this.transform(this.value,"screen"),this.vertical=this.slider.vertical,this.step=this.slider.step,this.scroll_step=this.slider.scroll_step,this.selected=!1,this.elem.css(`${this.slider.dir_attr}`,this.pos),this.slide_start=this.slide_start.bind(this),this.handle_drag=this.handle_drag.bind(this),this.resize_handle=this.resize_handle.bind(this),this.scroll_handle=this.scroll_handle.bind(this),this.key_handle=this.key_handle.bind(this),this.elem.on("mousedown touchstart",this.slide_start),s(window).on("resize",this.resize_handle)}get offset(){return this.slider.offset}get value(){return this._value}get selected(){return this._selected}set selected(e){e?(s(".yafowil_slider").each((function(){for(let e of s(this).data("slider_widget").handles)e.selected=!1})),this.elem.addClass("active"),this.slider.elem.on("mousewheel wheel",this.scroll_handle),s(document).off("keydown").on("keydown",this.key_handle)):(this.elem.removeClass("active"),this.slider.elem.off("mousewheel wheel",this.scroll_handle),s(document).off("keydown",this.key_handle)),this._selected=e}set value(e){if(e<this.slider.min||e>this.slider.max)return;let t=this.slider.handles.indexOf(this);if(this.slider.range_true&&t>=0)for(let s in this.slider.handles){let i=this.slider.handles[s];(e>=i.value&&s>t||e<=i.value&&s<t)&&(e=i.value)}if(this.input_elem.attr("value",e),this.span_elem.text(e),e!==this.value){let i=new s.Event("slidechange",{handle:this.elem,handleIndex:t,value:e});this.slider.elem.trigger(i)}this._value=e}get pos(){return this._pos}set pos(e){let s=this.slider.handles.indexOf(this);if(this.slider.range_true&&s>=0)for(let t in this.slider.handles){let i=this.slider.handles[t];(e>=i.pos&&t>s||e<=i.pos&&t<s)&&(e=i.pos)}e>=this.slider.slider_dim?e=this.slider.slider_dim:e<=0&&(e=0),this.elem.css(`${this.slider.dir_attr}`,`${e}px`),this._pos=e}unload(){s(window).off("resize",this.resize_handle),this.selected=!1}resize_handle(){this.pos=this.transform(this.value,"screen")}slide_start(e){this.selected=!0,e.preventDefault(),e.stopPropagation(),s(".slider-handle").css("z-index",1),this.elem.css("z-index",10);let t=new s.Event("slidestart",{handle:this.elem,handleIndex:this.slider.handles.indexOf(this),value:this.value});this.slider.elem.trigger(t),["mousemove","touchmove"].forEach((e=>document.addEventListener(e,this.handle_drag,{passive:!1}))),["mouseup","touchend"].forEach((e=>document.addEventListener(e,(()=>{document.removeEventListener("touchmove",this.handle_drag),document.removeEventListener("mousemove",this.handle_drag);let e=new s.Event("slidestop",{handle:this.elem,handleIndex:this.slider.handles.indexOf(this),value:this.value});this.slider.elem.trigger(e)}),!1)))}scroll_handle(e){e.preventDefault();let s=e.originalEvent,t=this.value;s.deltaY>0?t=parseInt(this.value)+this.scroll_step:s.deltaY<0&&(t=parseInt(this.value)-this.scroll_step),this.pos=this.transform(t,"screen"),this.value=t,this.slider.slider_track.set_value(e)}key_handle(e){let s=this.value,t=this.vertical?"ArrowDown"===e.key:"ArrowRight"===e.key,i=this.vertical?"ArrowUp"===e.key:"ArrowLeft"===e.key;t?(e.preventDefault(),s=parseInt(this.value)+this.scroll_step):i&&(e.preventDefault(),s=parseInt(this.value)-this.scroll_step),this.pos=this.transform(s,"screen"),this.value=s,this.slider.slider_track.set_value(e)}handle_drag(e){if(e.preventDefault(),e.stopPropagation(),"mousemove"===e.type?this.pos=(this.vertical?e.pageY:e.pageX)-this.offset:this.pos=(this.vertical?e.touches[0].pageY:e.touches[0].pageX)-this.offset,this.slider.step){let e=this.transform(this.pos,"range");this.value=this.transform(e,"step"),this.pos=this.transform(this.value,"screen")}else this.value=this.transform(this.pos,"range");const t=new s.Event("slide",{handle:this.elem,handleIndex:this.slider.handles.indexOf(this),value:this.value,values:[this.slider.handles[0].value,this.slider.handles[1]?this.slider.handles[1].value:null]});this.slider.elem.trigger(t)}transform(e,s){let i=this.slider.min,l=this.slider.max,h=this.slider.step;return t(e,s,this.slider.slider_dim,i,l,h)}}class l{constructor(e){this.slider=e,this.track_elem=s("<div />").addClass("slider-value-track"),this.bg_elem=s("<div />").addClass("slider-bg"),this.slider.slider_elem.append(this.bg_elem).append(this.track_elem),this.slider.vertical?(this.track_elem.css("width",this.slider.thickness),this.bg_elem.css("width",this.slider.thickness)):(this.track_elem.css("height",this.slider.thickness),this.bg_elem.css("height",this.slider.thickness)),this.slider.range_max&&(this.slider.vertical?this.track_elem.css("bottom",0).css("top","unset"):this.track_elem.css("right",0)),this.set_value(),this.set_value=this.set_value.bind(this),this.slider.elem.on("slide",this.set_value),s(window).on("resize",this.set_value)}unload(){s(window).off("resize",this.set_value)}set_value(e){let s=this.slider.handles[0].pos;if(this.slider.range_true){let e=this.slider.handles[1].pos-this.slider.handles[0].pos;this.track_elem.css(`${this.slider.dim_attr}`,e).css(`${this.slider.dir_attr}`,`${s}px`)}else this.slider.range_max?this.track_elem.css(`${this.slider.dim_attr}`,this.slider.slider_dim-s):this.track_elem.css(`${this.slider.dim_attr}`,s)}}class h{static initialize(e){s(".yafowil_slider",e).each((function(){let e=s(this),t=e.data();new h(e,t)}))}constructor(e,t){e.data("slider_widget",this),this.elem=e,this.range=!!t.range&&t.range,this.handle_diameter=t.handle_diameter?t.handle_diameter:20,this.thickness=t.thickness?t.thickness:8,this.min=t.min?t.min:0,this.max=t.max?t.max:100,this.step=!!t.step&&t.step;let h=t.scroll_step?t.scroll_step:1;this.scroll_step=t.step?t.step:h,this.slider_elem=s("div.slider",this.elem),this.vertical="vertical"===t.orientation,this.dim_attr=this.vertical?"height":"width",this.dir_attr=this.vertical?"top":"left",this.vertical?(this.slider_elem.addClass("slider-vertical"),this.slider_elem.css("width",this.handle_diameter),this.slider_elem.css("height",t.height)):this.slider_elem.css("height",this.handle_diameter),this.handles=[],this.range_true?(this.handles.push(new i(this,s("input.lower_value",this.elem),s("span.lower_value",this.elem))),this.handles.push(new i(this,s("input.upper_value",this.elem),s("span.upper_value",this.elem)))):this.handles.push(new i(this,s("input.slider_value",this.elem),s("span.slider_value",this.elem))),this.slider_track=new l(this),this.handle_singletouch=this.handle_singletouch.bind(this),this.slider_elem.on("mousedown touchstart",this.handle_singletouch),this.elem.trigger(new s.Event("slidecreate",{slider:this}))}get range_max(){return"max"===this.range}get range_true(){return!0===this.range}get offset(){return this.vertical?this.slider_elem.offset().top:this.elem.offset().left}get slider_dim(){return this.vertical?this.slider_elem.height():this.elem.width()}unload(){this.slider_track.unload();for(let e of this.handles)e.unload()}handle_singletouch(e){let s,t;if(this.range_true){let s=[];for(let t of this.handles){let i="mousedown"===e.type?e.pageX:e.touches[0].pageX,l="mousedown"===e.type?e.pageY:e.touches[0].pageY,h=Math.hypot(t.elem.offset().left-parseInt(i),t.elem.offset().top-parseInt(l));s.push(parseInt(h))}let i=s.indexOf(Math.min(...s));t=this.handles[i]}else t=this.handles[0];t.selected=!0,s="mousedown"===e.type?(this.vertical?e.pageY:e.pageX)-this.offset:(this.vertical?e.touches[0].pageY:e.touches[0].pageX)-this.offset,this.step?(s=t.transform(s,"range"),t.value=t.transform(s,"step"),t.pos=t.transform(t.value,"screen")):(t.pos=s,t.value=t.transform(s,"range")),this.slider_track.set_value(e)}}s((function(){void 0!==window.ts?ts.ajax.register(h.initialize,!0):h.initialize()})),e.SliderWidget=h,e.transform=t,Object.defineProperty(e,"__esModule",{value:!0}),void 0===window.yafowil&&(window.yafowil={}),window.yafowil.slider=e}({},jQuery);
