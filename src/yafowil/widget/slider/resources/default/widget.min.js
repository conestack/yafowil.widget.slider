var yafowil_slider=function(e,t){"use strict";function s(e){if(!e)return null;let t,s=e.split("."),i=window;for(const e in s){if(t=s[e],void 0===i[t])throw"'"+t+"' not found.";i=i[t]}return i}class i{constructor(e,s,i){this.slider=e;let l=e.handle_diameter;this.elem=t("<div />").addClass("slider-handle").width(l).height(l).appendTo(e.elem).data("slider-handle",this),this.index=s,this.value=i,this._on_start=this._on_start.bind(this),this._on_move=this._on_move.bind(this),this._on_end=this._on_end.bind(this),this._on_scroll=this._on_scroll.bind(this),this._on_key=this._on_key.bind(this),this._on_resize=this._on_resize.bind(this),this.selected=!1,this.elem.on("mousedown touchstart",this._on_start),t(window).on("resize",this._on_resize),this._force_value=!1}get value(){return this._value}set value(e){let t=this.slider,s=t.min,i=t.max,l=t.vertical;e=this._align_value(e),(e=this._prevent_overlap(e))<s?e=s:e>i&&(e=i);let a=t.size*((e-s)/(i-s));a=l?t.elem.height()-a:a,this.elem.css(""+(l?"top":"left"),`${a}px`),this._pos=a,this._value=e}get pos(){return this._pos}set pos(e){let t=this.slider,s=t.min,i=t.max,l=t.size;e=t.vertical?t.elem.height()-e:e,this.value=e/l*(i-s)+s}get selected(){return this._selected}set selected(e){let s=this.elem,i=this.slider;e?(i.unselect_handles(),s.addClass("active").css("z-index",10),i.elem.on("mousewheel wheel",this._on_scroll),t(document).on("keydown",this._on_key)):(s.removeClass("active").css("z-index",1),i.elem.off("mousewheel wheel",this._on_scroll),t(document).off("keydown",this._on_key)),this._selected=e}destroy(){t(window).off("resize",this._on_resize),this.selected=!1}_on_resize(){this.value=this.value}_on_start(e){e.preventDefault(),e.stopPropagation(),this.selected=!0,this.slider.trigger("start",this),t(document).on("mousemove touchmove",this._on_move).on("mouseup touchend",this._on_end)}_on_move(e){e.preventDefault(),e.stopPropagation();let t=this.slider;this.pos=t.pos_from_evt(e),t.trigger("slide",this)}_on_end(e){e.preventDefault(),t(document).off("mousemove touchmove",this._on_move).off("mouseup touchend",this._on_end),this.slider.trigger("stop",this)}_on_scroll(e){e.preventDefault();let t=e.originalEvent,s=this.slider,i=s.scroll_step,l=this.value;t.deltaY>0?l=this.value+i:t.deltaY<0&&(l=this.value-i),this.value=l,s.track.update(),s.trigger("change",this)}_on_key(e){let t=this.value,s=this.slider,i=s.scroll_step,l=s.vertical,a=l?"ArrowUp"===e.key:"ArrowRight"===e.key,n=l?"ArrowDown"===e.key:"ArrowLeft"===e.key;if(a)e.preventDefault(),t=this.value+i;else{if(!n)return;e.preventDefault(),t=this.value-i}this.value=t,s.track.update(),s.trigger("change",this)}_align_value(e){let t=this.slider,s=t.min,i=t.step;if(i){let t=(e-=s)%i;e=Math.floor(e/i)*i,t>=i/2&&(e+=i),e+=s}return Math.round(e)}_prevent_overlap(e){if(this._force_value)return e;let t=this.slider.handles,s=this.index;if(void 0===t)return e;if(s>0){let i=t[s-1];e<i.value&&(e=i.value)}if(s<t.length-1){let i=t[s+1];e>i.value&&(e=i.value)}return e}}class l{constructor(e){this.slider=e;let s=e.vertical,i=e.thickness,l=s?"width":"height";this.elem=t("<div />").addClass("slider-bg").css(l,i).appendTo(e.elem),this.range_elem=null;let a=e.range;if(a){let n=this.range_elem=t("<div />").addClass("slider-value-track").css(l,i).appendTo(e.elem);"min"===a&&s?n.css("bottom",0).css("top","auto"):"max"!==a||s||n.css("right",0)}this.update=this.update.bind(this),e.elem.on("slide",this.update),t(window).on("resize",this.update),this.update()}destroy(){t(window).off("resize",this.update)}update(){let e=this.slider,t=e.range;if(!t)return;let s=e.handles,i=s[0].pos,l=!0===t?s[1].pos:null,a=this.range_elem;e.vertical?!0===t?a.css("height",i-l).css("top",`${l}px`):"min"===t?a.css("height",e.size-i):"max"===t&&a.css("height",i):!0===t?a.css("width",l-i).css("left",`${i}px`):"min"===t?a.css("width",i):"max"===t&&a.css("width",e.size-i)}}class a{constructor(e,t){let s;void 0!==window.ts&&ts.ajax.attach(this,e),this.elem=e,this.range=t.range||!1,this.handle_diameter=t.handle_diameter||20,this.thickness=t.thickness||8,this.min=t.min||0,this.max=t.max||100,this.step=t.step||!1,this.scroll_step=t.step||t.scroll_step||1,this.vertical="vertical"===t.orientation,this.vertical?e.addClass("slider-vertical").css("width",this.handle_diameter).css("height",t.height):e.css("height",this.handle_diameter),!0===this.range?(s=t.value||[0,0],this.handles=[new i(this,0,s[0]),new i(this,1,s[1])]):(s=t.value||0,this.handles=[new i(this,0,s)]),this.track=new l(this),this._on_down=this._on_down.bind(this),this.elem.on("mousedown touchstart",this._on_down);for(let e of["change","create","slide","start","stop"])t[e]&&this.elem.on(e,t[e]);this.trigger("create",this)}get value(){let e=this.handles;if(1==e.length)return e[0].value;let t=[];for(let s of e)t.push(s.value);return t}set value(e){e instanceof Array||(e=[e]);let t=this.handles;if(e.length!==t.length)throw new Error("Invalid value size");let s,i=0;for(let t of e){if(t<this.min||t>this.max)throw new Error("Value out of bounds");if(i>t){throw new Error("Single values in range must be in ascending order")}i=t}for(let i in t)s=t[i],s._force_value=!0,s.value=e[i],s._force_value=!1;this.track.update()}get size(){let e=this.elem;return this.vertical?e.height():e.width()}on(e,t){this.elem.on(e,t)}off(e,t){this.elem.off(e,t)}trigger(e,s){this.elem.trigger(new t.Event(e,{widget:s}))}destroy(){this.track.destroy();for(let e of this.handles)e.destroy()}unselect_handles(){t("div.slider-handle").each((function(){t(this).data("slider-handle").selected=!1}))}pos_from_evt(e){let t=this.vertical,s=this.elem.offset(),i=t?s.top:s.left;return"mousedown"===e.type||"mousemove"===e.type?(t?e.pageY:e.pageX)-i:(t?e.touches[0].pageY:e.touches[0].pageX)-i}_on_down(e){let t;t=!0===this.range?this._closest_handle(this.pos_from_evt(e)):this.handles[0],t.selected=!0,t.pos=this.pos_from_evt(e),this.track.update(),this.trigger("change",t)}_closest_handle(e){let t=this.handles,s=this.vertical,i=s?t[t.length-1]:t[0],l=s?t[0]:t[t.length-1];if(e<=i.pos)return i;if(e>=l.pos)return l;let a=[];for(let s of t)a.push(Math.abs(e-s.pos));return t[a.indexOf(Math.min(...a))]}}class n{static initialize(e){t(".yafowil_slider",e).each((function(){let e=t(this);void 0!==window.yafowil_array&&window.yafowil_array.inside_template(e)||new n(e,{min:e.data("min"),max:e.data("max"),step:e.data("step"),scroll_step:e.data("scroll_step"),range:e.data("range"),handle_diameter:e.data("handle_diameter"),thickness:e.data("thickness"),orientation:e.data("orientation"),height:e.data("height"),change:s(e.data("change")),create:s(e.data("create")),slide:s(e.data("slide")),start:s(e.data("start")),stop:s(e.data("stop"))})}))}constructor(e,s){e.data("yafowil-slider",this),this.elem=e,this.range=s.range,!0===this.range?(this.elements=[{input:t("input.lower_value",e),label:t("span.lower_value",e)},{input:t("input.upper_value",e),label:t("span.upper_value",e)}],s.value=[parseInt(this.elements[0].input.val()),parseInt(this.elements[1].input.val())]):(this.elements=[{input:t("input.slider_value",e),label:t("span.slider_value",e)}],s.value=parseInt(this.elements[0].input.val())),this.slider=new a(t("div.slider",e),s),this.slider.on("change slide stop",(e=>{this._update_value(e.widget)}))}get value(){return this.slider.value}set value(e){let t=this.slider;t.value=e;for(let e of t.handles)this._update_value(e)}_update_value(e){let t=e.index,s=this.elements[t];s.input.attr("value",e.value),s.label.html(e.value)}}function r(e,t){n.initialize(t,!0)}function h(){void 0!==window.yafowil_array&&window.yafowil_array.on_array_event("on_add",r)}return t((function(){void 0!==window.ts?ts.ajax.register(n.initialize,!0):void 0!==window.bdajax?bdajax.register(n.initialize,!0):n.initialize(),h()})),e.Slider=a,e.SliderHandle=i,e.SliderWidget=n,e.lookup_callback=s,e.register_array_subscribers=h,Object.defineProperty(e,"__esModule",{value:!0}),window.yafowil=window.yafowil||{},window.yafowil.slider=e,e}({},jQuery);
